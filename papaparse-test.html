
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="Katie Taylor">
  <!-- <meta name="description" content=""> -->
  <!-- <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.css"> -->
  <!-- <link rel="icon" type="" href=""> -->
  <title>High Charts Test</title>

  <!-- <script src="https://code.highcharts.com/highcharts.js"></script> -->
  <script src="https://code.highcharts.com/maps/highmaps.js"></script>
  <!-- <script src="https://code.highcharts.com/mapdata/countries/us/us-all.js"></script> -->
  <!-- <script src="https://code.highcharts.com/mapdata/countries/us/us-all-all.js"></script> -->
  <script src="https://code.highcharts.com/mapdata/countries/us/custom/us-all-territories.js"></script>
  <script src="https://code.highcharts.com/mapdata/custom/world.js"></script>
  <script src="https://code.highcharts.com/maps/modules/data.js"></script>
  <script src="https://code.highcharts.com/maps/modules/exporting.js"></script>
  <script src="https://code.highcharts.com/maps/modules/offline-exporting.js"></script>

  <link rel="stylesheet" type="text/css" href="//github.com/downloads/lafeber/world-flags-sprite/flags32.css" />

    <!-- Census Downloads from 3rd Parties -->
    <link rel='stylesheet' href='https://www.census.gov/etc.clientlibs/census/clientlibs/bootstrap.css' type='text/css'/>

</head>
<body>

  <style>
    .container {
      width: 100%;
    }
  </style>


  <h2>Custom map from local geojson </h2>
  <div id="highMapsContainer1" class="container"> </div>

    <!-- Census Downloads from 3rd Parties -->
    <script type='text/javascript' src='https://www.census.gov/etc.clientlibs/clientlibs/granite/jquery.js'></script> <!-- actual jQuery, not jQuery UI-->
    <script type='text/javascript' src='https://www.census.gov/etc.clientlibs/census/clientlibs/bootstrap.js'></script>
    <script type='text/javascript' src='./papaparse.min.js'></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    
    // Chart #1: Custom map from local geojson
    async function renderLocalMap() {
        // let geoTypesFile = './data/us-with-territories.json';
        let geoTypesFile = './data/us-with-pr.json';
        const geoJson = await $.ajax({
            url: geoTypesFile,
            dataType: 'json',
            error: () => {console.log(`cannot get data from ${geoTypesFile}`);}
        }); 

        let csvFile = './data/all1r_010_all_occs_2.csv';
        let parsedData = Papa.parse(csvFile, {
            // worker: true,
            download: true, // makes the parsing confusingly async, requires complete()
            header: true,
            dynamicTyping: true, // make numbers not strs
            // step: function(row) { // process row-by-row
            //     console.log("Row:", row.data);
            // },
            complete: function(result) {
                console.log("All done! Raw result:");
                console.log(result);
                let data = result.data;
                displayData(data);
            }
        });

        // var parsedData = Papa.parse(csvFile, {
        //     header: true
        // });

        function displayData(data) {
            console.log('parsed data:');
            console.log(data);

            // manipulate data into correct form

            // e.g. ignore non-data rows
            let newData = [];
            data.forEach((obj) => {
                if (obj['ESTIMATE_1'] != null) {// no data
                    newData.push(obj);
                }
            })
            data = newData;

            // let data = parsedData;
            console.log('filtered data:');
            console.log(data);

            // Example data for testing
            // data = [
            //     ['Alabama',10],
            //     ['Alaska',11],
            //     ['Arizona',12],
            //     ['Arkansas',13],
            //     ['California',14],
            //     ['Colorado',15],
            //     ['Connecticut',16],
            //     ['Delaware',17],
            //     // ['District of Columbia',18],
            //     ['Florida',19],
            //     ['Georgia',110],
            //     ['Hawaii',111],
            //     ['Idaho',112],
            //     ['Illinois',113],
            //     ['Indiana',114],
            //     ['Iowa',115],
            //     ['Kansas',116],
            //     ['Kentucky',117],
            //     ['Louisiana',118],
            //     ['Maine',119],
            //     ['Maryland',120],
            //     ['Massachusetts',121],
            //     ['Michigan',122],
            //     ['Minnesota',123],
            //     ['Mississippi',124],
            //     ['Missouri',125],
            //     ['Montana',126],
            //     ['Nebraska',127],
            //     ['Nevada',128],
            //     ['New Hampshire',129],
            //     ['New Jersey',130],
            //     ['New Mexico',131],
            //     ['New York',132],
            //     ['North Carolina',133],
            //     ['North Dakota',134],
            //     ['Ohio',135],
            //     ['Oklahoma',136],
            //     ['Oregon',137],
            //     ['Pennsylvania',138],
            //     ['Rhode Island',139],
            //     ['South Carolina',140],
            //     ['South Dakota',141],
            //     ['Tennessee',142],
            //     ['Texas',143],
            //     ['Utah',144],
            //     ['Vermont',145],
            //     ['Virginia',146],
            //     ['Washington',147],
            //     ['West Virginia',148],
            //     ['Wisconsin',149],
            //     ['Wyoming',150],
            //     ['Puerto Rico',151]
            // ];

            // example data test w/ objs; don't forget to enable correct series configs
            data = [
                {
                    GEONAME: "Alabama",
                    value: 10,
                },
                {
                    GEONAME: "Alaska",
                    value: 100,
                },
                {
                    GEONAME: "Arizona",
                    value: 50,
                },
                {
                    GEONAME: "Arkansas",
                    value: 11,
                },
                {
                    GEONAME: "California",
                    value: 90,
                }
            ];

            // Create the chart
            Highcharts.mapChart('highMapsContainer1', {
                // chart: {
                    // map: 'countries/us/custom/us-all-territories'
                    // map: geoJson
                // },

                title: {
                    text: 'Highmaps using local geojson'
                },

                subtitle: {
                    // text: 'Source map: <a href="http://code.highcharts.com/mapdata/countries/us/custom/us-all-territories.js">United States of America with Territories</a>'
                },

                mapNavigation: {
                    enabled: true,
                    buttonOptions: {
                        verticalAlign: 'bottom'
                    }
                },

                colorAxis: {
                    min: 0
                },

                series: [{
                    data: data,

                    // example simple arr data configs:
                    // keys: ['name', 'value'], // labels columns in data array (for joinBy); works for example data
                    // joinBy: 'name', // shared data: name; works for example data

                    // example obj data configs:
                    joinBy: ['name', 'GEONAME'],

                    // eeo data configs
                    // joinBy: ['name', 'GEONAME'], // maps mapData property key to data column;

                    mapData: geoJson,
                    name: 'Random data',

                    states: {
                        hover: {
                            color: '#BADA55'
                        }
                    },
                    dataLabels: {
                        enabled: true,
                        format: '{point.name}'
                    }
                // }, {
                //     name: 'Separators',
                //     type: 'mapline',
                //     data: Highcharts.geojson(Highcharts.maps['countries/us/custom/us-all-territories'], 'mapline'),
                //     color: 'silver',
                //     nullColor: 'silver',
                //     showInLegend: false,
                //     enableMouseTracking: false
                }]
            });
        }

        return;
    }
    renderLocalMap();

    return;
});
</script>

</body>
</html>